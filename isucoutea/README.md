# 技術試験（アプリケーション高速化）

## 問題の背景

Webアプリケーションを開発する上で、高速化の基本的知識は必要不可欠です。  
何気なく書いたコードがとても重い処理を含んでいて、レスポンスに10秒もかかる事態になっていたらユーザ体験は最悪なものになってしまいます。

ここには高速化について全く考えられていない、茶葉の閲覧/投稿サービスがあります。  
あなたの手でできる限りの高速化を施してください。

## 問題

この課題では、Webアプリケーションのレスポンス速度を可能な限り速くして頂きます。  
Webアプリケーションの参考実装として、Python, Ruby, Go での実装を用意していますが、その他の言語を使用して同じ挙動をするアプリケーションを作成していただいても構いません。使用するフレームワークも変更可能です。

### アプリケーションの起動方法

```
$ cd exam_SWE/isucoutea
$ docker-compose up
$ docker exec -it isucoutea_app_1 /bin/bash
```

以下、各言語実装による。

Python実装の場合

```
$ cd ~/webapp/python
$ uwsgi app.ini
```

Ruby実装の場合

```
$ cd ~/webapp/ruby
$ puma -C config_puma.rb
```

Go実装の場合

```
$ cd ~/webapp/go
$ go get -t -d -v ./...
$ go build -o webapp
$ ./webapp
```

アプリケーション起動後、 `http://localhost` にアクセスすることでアプリケーションの動作確認をすることができます。

### ベンチマーカーの実行

ベンチマーカーの実行によってどれだけ高速化できたかを計測します。  
アプリケーションを起動後、以下のコマンドをコンテナ内で実行します。

```
$ docker exec -it isucoutea_app_1 /bin/bash
$ python benchmark.py
Timeout:  GET /?page=25&query=平塚市
Timeout:  GET /?page=858&query=日本
Timeout:  GET /
Timeout:  POST /
…
Result: 199.96370339393616 sec
```

benchmark.py はいくつかのエンドポイントにリクエストを投げて、応答時間を総計して出力しています。  
この時間をできるだけ短縮することがこの課題の目標です。
ただし、初期実装では文字列検索(`/?query=hoge`)のレスポンス速度が大変遅く、Timeout(>20sec) します。


### 課題の提出方法

コードとあわせて、`exam_SWE/isucoutea/note.md` にあなたの高速化ログを残してください。  
作業ログは厳密に記録する必要はなく、ある時点で計測を忘れた場合には、結果部分は空白で結構です。


### 注意事項

#### やってはいけないこと

* 茶葉を新規登録したのに一覧画面に表示されない等、本来期待しているアプリケーションの動き通りに動かないこと
  * ベンチマーカーにはバリデーションの機能が付いていないのでご注意ください。
* `/initialize` の処理内容において、削除せず残してある初期データに対して変更を加えること。
  * 既存テーブルにカラムを追加してそこに独自のデータを入れることは問題ありません。
* ベンチマーカーがリクエストしているクエリに特化した高速化処理をいれること。
  * 別の文字列を検索クエリにしたときにも同等のパフォーマンスが出ることを保証してください。
* teas テーブルの情報を **すべて** メモリ上に置くこと。
  * お茶の情報は今後50倍、100倍に増える可能性があるため、(説明文を除いたとしても)tea テーブルのすべてはメモリ上には載らないものとします。


#### やって良いこと

* 原則やっていはいけないことに書いたこと以外は何をしても構いません。
* インメモリデータベースや全文検索エンジンなどを追加でインストールすることもOKです。
* 初期データが入っているテーブルを2つに分割することもOKです。ただし入っているデータの文字列に変更は加えないでください。
* やってよいか判断がつかない場合には Issue にて起票ください。


#### 採点基準

* 高速化した手法毎に加点していく方式です、node.md には実施した内容を丁寧に記述してください。
* (実装言語にも依りますが)目安としてベンチマーカーの実行時間を初期実装の約200分の1以下にすることを目標として取り組んでください。
